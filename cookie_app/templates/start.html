{% extends 'home.html' %}
{% load static %} 

{% block title %}Color Cookies{% endblock %}

{% block content %}
<div id="gameContainer">
    <div id="lives">
      <div class="life" id="life1"></div>
      <div class="life" id="life2"></div>
      <div class="life" id="life3"></div>
      <div class="life" id="life4"></div>
      <div class="life" id="life5"></div>
    </div>

    <div id="questionContainer">
      <p id="questionText"></p>
    </div>

    <div id="cookieContainer"></div>

    <div id="gameOverMessage">
      <p>Game Over! <button id="retryButton">Try Again</button></p>
    </div>
  </div>

  <script>
    const cookieColors = [
        { color: 'red', img: "{% static 'images/cookies/cookiered.png' %}" },
        { color: 'blue', img: "{% static 'images/cookies/cookieblue.png' %}" },
        { color: 'green', img: "{% static 'images/cookies/cookiegreen.png' %}" },
        { color: 'yellow', img: "{% static 'images/cookies/cookieyellow.png' %}" },
        { color: 'pink', img: "{% static 'images/cookies/cookiepink.png' %}" },
        { color: 'orange', img: "{% static 'images/cookies/cookieorange.png' %}" },
        { color: 'brown', img: "{% static 'images/cookies/cookiebrown.png' %}" },
        { color: 'black', img: "{% static 'images/cookies/cookieblack.png' %}" }
    ];

     // Load the background music
    const backgroundMusic = new Audio("{% static 'sounds/frozen_winter.mp3' %}");
    backgroundMusic.loop = true;  // Loop the background music

    // Play the background music when the page loads
    window.onload = function() {
      backgroundMusic.play();
    };

    // Add event listener for visibility change to pause/resume music
    document.addEventListener('visibilitychange', function() {
      if (document.hidden) {
        backgroundMusic.pause();  // Pause music when the tab is not active
      } else {
        backgroundMusic.play();   // Resume music when the tab becomes active
      }
    });

    // Load sound effect
    const correctSound = new Audio("{% static 'sounds/correct.mp3' %}");
    correctSound.volume = 0.1; 
    const wrongSound = new Audio("{% static 'sounds/wrong.wav' %}");
    wrongSound.volume = 0.5; 
    const gameoverSound = new Audio("{% static 'sounds/gameover.mp3' %}");
    gameoverSound.volume = 0.1;

    let lives = 5;
    let correctColor;

    const questionText = document.getElementById('questionText');
    const cookieContainer = document.getElementById('cookieContainer');
    const lifeCircles = document.querySelectorAll('.life');
    const retryButton = document.getElementById('retryButton');
    const gameOverMessage = document.getElementById('gameOverMessage');

    function startGame() {
      lives = 5;
      gameOverMessage.style.display = 'none';
      generateNewQuestion();
      updateLives();
    }

    function updateLives() {
      lifeCircles.forEach((circle, index) => {
        circle.style.backgroundColor = index < lives ? 'green' : 'gray';
      });
    }

    function generateNewQuestion() {
      // Pick a random text to display and a random color for the text
      const randomTextIndex = Math.floor(Math.random() * cookieColors.length);
      const randomTextColorIndex = Math.floor(Math.random() * cookieColors.length);

      const randomText = cookieColors[randomTextIndex].color; // Text content
      const randomTextColor = cookieColors[randomTextColorIndex].color; // Font color

      // Set the correct answer to the font color
      correctColor = randomTextColor;

      // Capitalize the first letter of the text content
      const capitalizedText = randomText.charAt(0).toUpperCase() + randomText.slice(1);

      // Display the question
      questionText.innerHTML = `${capitalizedText}`;
      questionText.style.color = randomTextColor;

      // Shuffle cookies and display the options
      const shuffledColors = shuffleArray(cookieColors);
      cookieContainer.innerHTML = '';

      shuffledColors.forEach(cookie => {
        const img = document.createElement('img');
        img.src = cookie.img;
        img.setAttribute('data-color', cookie.color); // Actual color of the cookie
        img.classList.add('cookie');
        cookieContainer.appendChild(img);
      });
    }

    function shuffleArray(array) {
      let shuffledArray = [...array];
      for (let i = shuffledArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffledArray[i], shuffledArray[j]] = [shuffledArray[j], shuffledArray[i]];
      }
      return shuffledArray;
    }

    cookieContainer.addEventListener('click', function(event) {
      if (event.target.classList.contains('cookie')) {
        const clickedColor = event.target.getAttribute('data-color');
        // Compare clicked color with the correct font color
        if (clickedColor === correctColor) {
          correctSound.play();
          generateNewQuestion();
        } else {
          wrongSound.play();
          lives--;
          updateLives();
          if (lives === 0) {
            gameoverSound.play();
            gameOver();
          }
        }
      }
    });

    function gameOver() {
      gameOverMessage.style.display = 'block';
    }

    retryButton.addEventListener('click', function() {
      startGame();
    });

    startGame();
  </script>
{% endblock %}
